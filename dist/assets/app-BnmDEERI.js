import{e as mt,w as et,r as Ye,l as ft,p as ee,a as j,o as Oe,g as e,m as A,b as we,d as tt,s as r,c as je,f as Te,i as te,t as k,h as at,j as i,k as o,n as E,q as R,u as X,v as Ie,x as B,y as _,z as Ve,A as ae,B as Re,C as he,D as be,E as ke,F as Se,G as q,H as Fe,$ as pt,I as _e,J as ie,K as ht,L as We,M as bt,N as Je,O as _t}from"./vendor-Dq_6iiw8.js";const yt="5";var Ze;typeof window<"u"&&((Ze=window.__svelte??(window.__svelte={})).v??(Ze.v=new Set)).add(yt);mt();const Ke="piggyBankAuthToken",ze="piggyBankUserInfo",Le="piggyBankUsername",Ue="piggyBankParentAuth",st=(s,t)=>{localStorage.setItem(Ke,s),localStorage.setItem(ze,JSON.stringify(t)),localStorage.setItem(Le,t.username)},wt=s=>{localStorage.setItem(Le,s)},me=()=>localStorage.getItem(Le),rt=s=>{s?sessionStorage.setItem(Ue,"true"):sessionStorage.removeItem(Ue)},Me=()=>localStorage.getItem(Ke),ot=()=>{const s=localStorage.getItem(ze);return s?JSON.parse(s):null},pe=()=>!!Me(),qe=()=>!!me(),nt=()=>pe()||qe(),lt=(s=!0)=>{localStorage.removeItem(Ke),localStorage.removeItem(ze),sessionStorage.removeItem(Ue),s&&localStorage.removeItem(Le)},Ae="/api",xt=(s={})=>{const t=Me();if(!t)return s;const a={...s.headers,Authorization:`Bearer ${t}`};return{...s,headers:a}},kt=(s={})=>{const t=me();if(!t)return s;const a={...s.headers,Authorization:`Bearer ${t}`};return{...s,headers:a}},St=async(s,t)=>{console.log(`尝试登录: 用户名=${s}, 密码长度=${t==null?void 0:t.length}`);try{const a=await fetch(`${Ae}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,password:t})});console.log(`登录响应状态: ${a.status}`);const l=await a.json();if(console.log("登录响应数据:",l),!a.ok)throw new Error(l.error||"登录失败");return st(l.token,l.user),console.log("登录成功，保存用户信息:",l.user),l}catch(a){throw console.error("登录失败:",a),a}},At=async(s,t,a)=>{try{const l=await fetch(`${Ae}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,password:t,displayName:a})});if(!l.ok){const v=await l.json();throw new Error(v.error||"注册失败")}const n=await l.json();return st(n.token,n.user),n}catch(l){throw console.error("注册失败:",l),l}},Dt=()=>{lt()},$t=async s=>{try{const t=await fetch(`${Ae}/check-username`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s})});if(!t.ok){const a=await t.json();throw new Error(a.error||"检查用户名失败")}return await t.json()}catch(t){throw console.error("检查用户名失败:",t),t}},ye=async()=>{if(!nt())return{balance:0,transactions:[],goals:[]};try{let s=pe()?xt():kt();const t=await fetch(`${Ae}/piggyBank`,s);if(!t.ok)throw new Error("无法获取数据");return await t.json()}catch(s){console.error("获取数据失败:",s),alert("获取数据失败")}},De=async s=>{if(!nt())return Ge(s);try{const t=pe()?`Bearer ${Me()}`:`Bearer ${me()}`,a=await fetch(`${Ae}/piggyBank`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify(s)});if(!a.ok)throw new Error("保存数据失败");const l=await a.json();return Ge(l),l}catch(t){return console.error("保存数据失败:",t),Ge(s)}},xe=s=>s.reduce((t,a)=>a.deposited||a.amount<0?t+a.amount:t,0),Bt=async(s,t)=>{const a=await ye();if(s<0){const n=xe(a.transactions);if(n+s<0)throw new Error(`余额不足！当前余额为 ¥${n.toFixed(2)}，无法取出 ¥${Math.abs(s).toFixed(2)}`)}const l={id:Date.now(),amount:s,description:t,date:new Date().toISOString(),deposited:s<=0};return a.transactions.unshift(l),a.balance=xe(a.transactions),await De(a)},Tt=async s=>{const t=await ye(),a=t.transactions.find(l=>l.id===s);return a?(a.deposited=!0,t.balance=xe(t.transactions),await De(t)):t},Ft=async(s,t)=>{const a=await ye(),l={id:Date.now(),name:s,amount:parseFloat(t),currentAmount:0,completed:!1};return a.goals.push(l),await De(a)},Lt=async s=>{const t=await ye(),a=t.goals.find(l=>l.id===s);if(a){const l=xe(t.transactions);if(l<a.amount)throw new Error(`余额不足！完成此目标需要 ¥${a.amount.toFixed(2)}，但当前余额仅有 ¥${l.toFixed(2)}`);const n={id:Date.now(),amount:-a.amount,description:`完成目标：${a.name}`,date:new Date().toISOString(),deposited:!0};return t.transactions.unshift(n),a.completed=!0,a.completedAt=new Date().toISOString(),a.deleted===void 0&&(a.deleted=!1),t.balance=xe(t.transactions),await De(t)}return t},Mt=async s=>{const t=await ye(),a=t.goals.find(l=>l.id===s);return a?a.completed?a.deleted=!0:t.goals=t.goals.filter(l=>l.id!==s):t.goals=t.goals.filter(l=>l.id!==s),await De(t)},Ge=s=>{const t=Me(),a=t?`piggyBank_${t}`:"piggyBank";return localStorage.setItem(a,JSON.stringify(s)),s},Pt={balance:0,transactions:[],goals:[]},fe=et(Pt),Qe=async()=>{try{const s=await ye();return fe.set(s),s}catch(s){console.error("刷新数据失败:",s)}},Et=async(s,t)=>{if(!t.trim())throw new Error("描述不能为空");try{const a=await Bt(parseFloat(s),t);return fe.set(a),a}catch(a){throw console.error("添加交易失败:",a),a}},Ct=async s=>{try{const t=await Tt(s);return fe.set(t),t}catch(t){throw console.error("标记交易失败:",t),t}},Gt=async(s,t)=>{try{const a=await Ft(s,t);return fe.set(a),a}catch(a){throw console.error("添加目标失败:",a),a}},It=async s=>{try{const t=await Lt(s);return fe.set(t),t}catch(t){throw console.error("完成目标失败:",t),t}},Ut=async s=>{try{const t=await Mt(s);return fe.set(t),t}catch(t){throw console.error("删除目标失败:",t),t}};function Xe(s){return Object.prototype.toString.call(s)==="[object Date]"}function Ne(s,t,a,l){if(typeof a=="number"||Xe(a)){const n=l-a,v=(a-t)/(s.dt||1/60),m=s.opts.stiffness*n,f=s.opts.damping*v,c=(m-f)*s.inv_mass,u=(v+c)*s.dt;return Math.abs(u)<s.opts.precision&&Math.abs(n)<s.opts.precision?l:(s.settled=!1,Xe(a)?new Date(a.getTime()+u):a+u)}else{if(Array.isArray(a))return a.map((n,v)=>Ne(s,t[v],a[v],l[v]));if(typeof a=="object"){const n={};for(const v in a)n[v]=Ne(s,t[v],a[v],l[v]);return n}else throw new Error(`Cannot spring ${typeof a} values`)}}function qt(s,t={}){const a=et(s),{stiffness:l=.15,damping:n=.8,precision:v=.01}=t;let m,f,c,u=s,x=s,y=1,w=0,b=!1;function D(S,p={}){x=S;const L=c={};return s==null||p.hard||$.stiffness>=1&&$.damping>=1?(b=!0,m=Ye.now(),u=S,a.set(s=x),Promise.resolve()):(p.soft&&(w=1/((p.soft===!0?.5:+p.soft)*60),y=0),f||(m=Ye.now(),b=!1,f=ft(h=>{if(b)return b=!1,f=null,!1;y=Math.min(y+w,1);const M=Math.min(h-m,1e3/30),P={inv_mass:y,opts:$,settled:!0,dt:M*60/1e3},C=Ne(P,u,s,x);return m=h,u=s,a.set(s=C),P.settled&&(f=null),!P.settled})),new Promise(h=>{f.promise.then(()=>{L===c&&h()})}))}const $={set:D,update:(S,p)=>D(S(x,s),p),subscribe:a.subscribe,stiffness:l,damping:n,precision:v};return $}const Nt="/assets/%E5%8D%A1%E9%80%9A%E5%B0%8F%E7%8B%97%E5%88%B6%E4%BD%9C-P1prLRqv.png";var Ot=k('<div class="coin svelte-14q6arr"></div>'),jt=k('<div class="piggy-bank-container svelte-14q6arr"><div class="doggy-bank svelte-14q6arr"><div class="dog-container svelte-14q6arr"><img alt="狗狗储钱罐" class="dog-image svelte-14q6arr"> <div class="coin-slot svelte-14q6arr"></div> <div class="money-fill svelte-14q6arr"></div></div> <!></div> <div class="balance-display svelte-14q6arr"><h2 class="svelte-14q6arr">当前余额</h2> <div class="amount svelte-14q6arr"> </div></div></div>');function Rt(s,t){ee(t,!1);const[a,l]=Re(),n=()=>je(f,"$displayBalance",a),v=A();let m=j(t,"balance",8,0);const f=qt(0,{stiffness:.1,damping:.4});let c=A(!1),u=A([]),x=null,y=!1;const w=()=>{const F={x:Math.random()*200-100,y:-150};r(u,[F]),r(c,!0),setTimeout(()=>{r(c,!1),r(u,[])},1e3)},b=F=>{x&&clearTimeout(x),y=!0;const K=Math.min(Math.max(Math.floor(F/10),1),5);r(u,Array.from({length:K},()=>({x:Math.random()*200-100,y:-150,delay:Math.random()*.5,size:Math.random()*.4+.8}))),r(c,!0);const T=Math.min(1e3+F*20,3e3);return x=setTimeout(()=>{r(c,!1),r(u,[]),x=null,y=!1},T),T};Oe(()=>{const F=setInterval(()=>{Math.random()>.7&&!e(c)&&!y&&w()},1e4);return()=>clearInterval(F)});const D=()=>y;we(()=>tt(m()),()=>{f.set(m())}),we(()=>n(),()=>{r(v,Math.min(n()/1e3*100,100))}),Te(),te();var $=jt(),S=o($),p=o(S),L=o(p);at(L,"src",Nt);var h=i(L,4),M=i(p,2);{var P=F=>{var K=he(),T=be(K);ke(T,1,()=>e(u),Se,(J,V)=>{var oe=Ot();R(()=>Ie(oe,`
            left: calc(50% + ${e(V).x??""}px); 
            top: ${e(V).y??""}px; 
            animation-delay: ${e(V).delay??""}s;
            transform: scale(${e(V).size??""});
          `)),_(J,oe)}),_(F,K)};E(M,F=>{e(c)&&F(P)})}var C=i(S,2),z=i(o(C),2),I=o(z);R(F=>{Ie(h,`height: ${e(v)??""}%`),B(I,`¥${F??""}`)},[()=>n().toFixed(2)],X),_(s,$),Ve(t,"animateMultipleCoins",b),Ve(t,"isAnimating",D);var N=ae({animateMultipleCoins:b,isAnimating:D});return l(),N}var Jt=k('<p class="empty-state">暂无待投入金额</p>'),Kt=k('<div class="transaction-item svelte-18kooq2"><div class="transaction-info svelte-18kooq2"><div class="transaction-amount svelte-18kooq2"> </div> <div class="transaction-desc svelte-18kooq2"> </div> <div class="transaction-date svelte-18kooq2"> </div></div> <button class="btn btn-accent deposit-btn svelte-18kooq2"> </button></div>'),zt=k('<div class="card"><h3> </h3> <!></div>');function Ht(s,t){ee(t,!1);const a=A();let l=j(t,"transactions",24,()=>[]),n=j(t,"onDeposit",8),v=j(t,"isAnimating",8,!1);we(()=>tt(l()),()=>{r(a,l().reduce((w,b)=>w+b.amount,0))}),Te(),te();var m=zt(),f=o(m),c=o(f),u=i(f,2);{var x=w=>{var b=Jt();_(w,b)},y=w=>{var b=he(),D=be(b);ke(D,1,l,Se,($,S)=>{var p=Kt(),L=o(p),h=o(L),M=o(h),P=i(h,2),C=o(P),z=i(P,2),I=o(z),N=i(L,2),F=o(N);R((K,T)=>{B(M,`+¥${K??""}`),B(C,e(S).description),B(I,T),N.disabled=v(),B(F,v()?"投入中...":"投入")},[()=>e(S).amount.toFixed(2),()=>new Date(e(S).date).toLocaleString()],X),q("click",N,()=>n()(e(S))),_($,p)}),_(w,b)};E(u,w=>{l().length===0?w(x):w(y,!1)})}R(w=>B(c,`待投入的金额 ${w??""}`),[()=>l().length>0?`(¥${e(a).toFixed(2)})`:""],X),_(s,m),ae()}var Yt=k('<div class="dialog-backdrop svelte-elx3bd"><div class="dialog-container svelte-elx3bd" role="dialog" aria-modal="true" aria-labelledby="dialog-title"><div class="dialog-header svelte-elx3bd"><h3 id="dialog-title" class="svelte-elx3bd"> </h3></div> <div class="dialog-content svelte-elx3bd"><p class="svelte-elx3bd"> </p></div> <div class="dialog-actions svelte-elx3bd"><button class="btn-cancel svelte-elx3bd"> </button> <button> </button></div></div></div>');function it(s,t){ee(t,!1);let a=j(t,"show",12,!1),l=j(t,"title",8,"确认操作"),n=j(t,"message",8,"您确定要执行此操作吗？"),v=j(t,"confirmText",8,"确认"),m=j(t,"cancelText",8,"取消"),f=j(t,"type",8,"primary");const c=Fe();function u(){c("confirm"),a(!1)}function x(){c("cancel"),a(!1)}function y(S){S.target===S.currentTarget&&x()}function w(S){S.key==="Escape"&&x()}te();var b=he();q("keydown",pt,w);var D=be(b);{var $=S=>{var p=Yt(),L=o(p),h=o(L),M=o(h),P=o(M),C=i(h,2),z=o(C),I=o(z),N=i(C,2),F=o(N),K=o(F),T=i(F,2),J=o(T);R(()=>{B(P,l()),B(I,n()),B(K,m()),_e(T,1,`btn-confirm ${f()??""}`,"svelte-elx3bd"),B(J,v())}),q("click",F,x),q("click",T,u),q("click",p,y),_(S,p)};E(D,S=>{a()&&S($)})}_(s,b),ae()}var Vt=k('<div class="error-message svelte-1gxcd81"> </div>'),Wt=k('<div class="goal-form svelte-1gxcd81"><div class="form-group svelte-1gxcd81"><label for="goalName" class="svelte-1gxcd81">目标名称：</label> <input type="text" id="goalName" placeholder="例如：新玩具、新书" class="svelte-1gxcd81"></div> <div class="form-group svelte-1gxcd81"><label for="goalAmount" class="svelte-1gxcd81">需要金额：</label> <input type="number" id="goalAmount" placeholder="输入需要的金额" min="0" step="0.01" class="svelte-1gxcd81"></div> <!> <button class="btn btn-secondary svelte-1gxcd81">创建目标</button></div>'),Qt=k('<p class="empty-state svelte-1gxcd81">暂无储蓄目标，添加一个吧！</p>'),Xt=k('<div class="goal-star svelte-1gxcd81">★</div>'),Zt=k('<div class="piggy-icon svelte-1gxcd81">🐷</div>'),ea=k('<button class="icon-btn complete-btn svelte-1gxcd81" title="标记为已完成">✓</button>'),ta=k('<div><div class="goal-icon svelte-1gxcd81"><!></div> <div class="goal-details svelte-1gxcd81"><h4 class="svelte-1gxcd81"> </h4> <div class="goal-progress-bar svelte-1gxcd81"><div class="goal-progress-fill svelte-1gxcd81"></div></div> <div class="goal-progress-info svelte-1gxcd81"><div class="goal-amount svelte-1gxcd81"> </div> <div class="goal-status svelte-1gxcd81"> </div></div></div> <div class="goal-actions svelte-1gxcd81"><!> <button class="icon-btn delete-btn svelte-1gxcd81" title="删除目标">✕</button></div></div>'),aa=k('<div class="goals-list svelte-1gxcd81"></div>'),sa=k('<div class="card svelte-1gxcd81"><div class="goals-header svelte-1gxcd81"><h3 class="svelte-1gxcd81">我的储蓄目标</h3> <button class="btn btn-secondary btn-small svelte-1gxcd81"> </button></div> <!> <!> <!></div>');function ra(s,t){ee(t,!1);let a=j(t,"goals",24,()=>[]),l=j(t,"balance",8,0),n=j(t,"onAddGoal",8),v=j(t,"onCompleteGoal",8),m=j(t,"onDeleteGoal",8),f=A(!1),c=A(""),u=A(""),x=A(""),y=A(!1),w=A(null),b=A(""),D=A(""),$=A("primary"),S=A("确认");const p=()=>{if(!e(c).trim()){r(x,"请输入目标名称");return}if(!e(u)||isNaN(parseFloat(e(u)))||parseFloat(e(u))<=0){r(x,"请输入有效的目标金额");return}n()(e(c),parseFloat(e(u))),r(c,""),r(u,""),r(x,""),r(f,!1)},L=d=>{const g=a().find(U=>U.id===d);if(g){if(l()<g.amount){alert(`余额不足！完成此目标需要 ¥${g.amount.toFixed(2)}，但当前余额仅有 ¥${l().toFixed(2)}`);return}r(D,"完成储蓄目标"),r(b,`确定要将"${g.name}"标记为已完成吗？将从余额中扣除 ¥${g.amount.toFixed(2)}。`),r($,"success"),r(S,"确认完成"),r(w,()=>{v()(d)}),r(y,!0)}},h=d=>{const g=a().find(U=>U.id===d);g&&(r(D,"删除储蓄目标"),r(b,`确定要删除"${g.name}"吗？此操作不可撤销。`),r($,"danger"),r(S,"确认删除"),r(w,()=>{m()(d)}),r(y,!0))},M=d=>Math.min(l()/d.amount*100,100),P=d=>{if(d.completed)return"已完成";const g=M(d);return g>=100?"已达成":g>=75?"即将达成":g>=50?"进行中":g>=25?"努力存钱中":"刚开始"};te();var C=sa(),z=o(C),I=i(o(z),2),N=o(I),F=i(z,2);{var K=d=>{var g=Wt(),U=o(g),G=i(o(U),2),H=i(U,2),W=i(o(H),2),se=i(H,2);{var ce=Q=>{var ne=Vt(),le=o(ne);R(()=>B(le,e(x))),_(Q,ne)};E(se,Q=>{e(x)&&Q(ce)})}var Z=i(se,2);ie(G,()=>e(c),Q=>r(c,Q)),ie(W,()=>e(u),Q=>r(u,Q)),q("click",Z,p),_(d,g)};E(F,d=>{e(f)&&d(K)})}var T=i(F,2);{var J=d=>{var g=Qt();_(d,g)},V=d=>{var g=aa();ke(g,5,a,Se,(U,G)=>{var H=ta();const W=X(()=>M(e(G))),se=X(()=>e(W)>=100||e(G).completed);let ce;var Z=o(H),Q=o(Z);{var ne=re=>{var ge=Xt();_(re,ge)},le=re=>{var ge=Zt();_(re,ge)};E(Q,re=>{e(se)?re(ne):re(le,!1)})}var O=i(Z,2),Y=o(O),ve=o(Y),de=i(Y,2),$e=o(de),Pe=i(de,2),Be=o(Pe),Ee=o(Be),ue=i(Be,2),Ce=o(ue),ct=i(O,2),He=o(ct);{var vt=re=>{var ge=ea();q("click",ge,()=>L(e(G).id)),_(re,ge)};E(He,re=>{e(G).completed||re(vt)})}var dt=i(He,2);R((re,ge,ut,gt)=>{ce=_e(H,1,"goal-card svelte-1gxcd81",null,ce,re),B(ve,e(G).name),Ie($e,`width: ${e(W)??""}%`),B(Ee,`进度：${ge??""}% (¥${ut??""})`),B(Ce,gt)},[()=>({"goal-completed":e(se)}),()=>Math.round(e(W)),()=>e(G).amount.toFixed(2),()=>P(e(G))],X),q("click",dt,()=>h(e(G).id)),_(U,H)}),_(d,g)};E(T,d=>{a().length===0?d(J):d(V,!1)})}var oe=i(T,2);it(oe,{get title(){return e(D)},get message(){return e(b)},get confirmText(){return e(S)},get type(){return e($)},get show(){return e(y)},set show(d){r(y,d)},$$events:{confirm:()=>e(w)&&e(w)()},$$legacy:!0}),R(()=>B(N,e(f)?"取消":"+ 添加目标")),q("click",I,()=>r(f,!e(f))),_(s,C),ae()}var oa=k('<div class="piggy-container svelte-dqqrvf"><!> <!> <!></div>');function na(s,t){ee(t,!1);const[a,l]=Re(),n=()=>je(fe,"$piggyBankStore",a),v=A();let m=A();const f=p=>{e(m).isAnimating()||(e(m).animateMultipleCoins(p.amount),Ct(p.id))},c=(p,L)=>{Gt(p,L)},u=p=>{It(p)},x=p=>{Ut(p)};we(()=>n(),()=>{r(v,n().transactions.filter(p=>p.amount>0&&!p.deposited))}),Te(),te();var y=oa(),w=o(y);ht(Rt(w,{get balance(){return n().balance},$$legacy:!0}),p=>r(m,p),()=>e(m));var b=i(w,2);const D=X(()=>{var p;return((p=e(m))==null?void 0:p.isAnimating())||!1});Ht(b,{get transactions(){return e(v)},onDeposit:f,get isAnimating(){return e(D)}});var $=i(b,2);const S=X(()=>n().goals.filter(p=>!p.deleted));ra($,{get goals(){return e(S)},get balance(){return n().balance},onAddGoal:c,onCompleteGoal:u,onDeleteGoal:x}),_(s,y),ae(),l()}var la=k('<div class="error-message"> </div>'),ia=k('<div class="card"><h3> </h3> <div class="form-group"><label><input type="radio"> 添加金额</label> <label><input type="radio"> 减少金额</label></div> <div class="form-group"><label for="amount">金额: <span class="required svelte-t3s0in">*</span></label> <input type="number" id="amount" placeholder="请输入金额" min="0" step="0.01" required></div> <div class="form-group"><label for="description">描述: <span class="required svelte-t3s0in">*</span></label> <input type="text" id="description" placeholder="例如：压岁钱、零花钱" required> <small>请描述这笔交易的来源或用途，必填</small></div> <!> <button class="btn"> </button> <!></div>');function ca(s,t){ee(t,!1);const a=[];let l=j(t,"balance",8,0),n=j(t,"onUpdateBalance",8),v=A(""),m=A(""),f=A(!0),c=A(""),u=A(!1),x=A(null),y=A(""),w=A("");const b=()=>{if(!e(v)||isNaN(parseFloat(e(v)))||parseFloat(e(v))<=0){r(c,"请输入有效金额（必须大于0）");return}if(!e(m).trim()){r(c,"请输入交易描述");return}if(!e(f)&&parseFloat(e(v))>l()){r(c,`余额不足！当前余额为 ¥${l().toFixed(2)}，无法取出 ¥${parseFloat(e(v)).toFixed(2)}`);return}r(c,"");const g=e(f)?parseFloat(e(v)):-parseFloat(e(v));r(w,e(f)?"确认存入金额":"确认取出金额"),r(y,`您确定要${e(f)?"存入":"取出"} ¥${Math.abs(g).toFixed(2)} 吗？
描述：${e(m)}`),r(x,()=>{try{n()(g,e(m)),r(v,""),r(m,"")}catch(U){r(c,U.message)}}),r(u,!0)};te();var D=ia(),$=o(D),S=o($),p=i($,2),L=o(p),h=o(L);h.value=h.__value=!0;var M=i(L,2),P=o(M);P.value=P.__value=!1;var C=i(p,2),z=i(o(C),2),I=i(C,2),N=i(o(I),2),F=i(I,2);{var K=g=>{var U=la(),G=o(U);R(()=>B(G,e(c))),_(g,U)};E(F,g=>{e(c)&&g(K)})}var T=i(F,2),J=o(T),V=i(T,2);const oe=X(()=>e(f)?"确认存入":"确认取出"),d=X(()=>e(f)?"primary":"danger");it(V,{get title(){return e(w)},get message(){return e(y)},get confirmText(){return e(oe)},get type(){return e(d)},get show(){return e(u)},set show(g){r(u,g)},$$events:{confirm:()=>e(x)&&e(x)()},$$legacy:!0}),R(g=>{B(S,`当前余额: ¥${g??""}`),B(J,e(f)?"存入":"取出")},[()=>l().toFixed(2)],X),We(a,[],h,()=>e(f),g=>r(f,g)),We(a,[],P,()=>e(f),g=>r(f,g)),ie(z,()=>e(v),g=>r(v,g)),ie(N,()=>e(m),g=>r(m,g)),q("click",T,b),_(s,D),ae()}var va=k('<p class="empty-state">暂无交易记录</p>'),da=k('<div class="transaction-item svelte-gibnnr"><div> </div> <div class="transaction-details svelte-gibnnr"><div class="transaction-desc svelte-gibnnr"> </div> <div class="transaction-date svelte-gibnnr"> </div> <div class="transaction-status svelte-gibnnr"><!></div></div></div>'),ua=k('<div class="transactions svelte-gibnnr"></div>'),ga=k('<div class="card"><h3>交易记录</h3> <!></div>');function ma(s,t){ee(t,!1);let a=j(t,"transactions",24,()=>[]);const l=c=>c?new Date(c).toLocaleString():"";te();var n=ga(),v=i(o(n),2);{var m=c=>{var u=va();_(c,u)},f=c=>{var u=ua();ke(u,5,a,Se,(x,y)=>{var w=da(),b=o(w);let D;var $=o(b),S=i(b,2),p=o(S),L=o(p),h=i(p,2),M=o(h),P=i(h,2),C=o(P);{var z=I=>{var N=bt();R(()=>B(N,`状态: ${e(y).deposited?"已存储":"待存储"}`)),_(I,N)};E(C,I=>{e(y).amount>0&&I(z)})}R((I,N,F)=>{D=_e(b,1,"transaction-amount svelte-gibnnr",null,D,I),B($,`${e(y).amount>0?"+":""}${N??""}`),B(L,e(y).description||"无描述"),B(M,F)},[()=>({positive:e(y).amount>0,negative:e(y).amount<0}),()=>e(y).amount.toFixed(2),()=>l(e(y).date)],X),_(x,w)}),_(c,u)};E(v,c=>{a().length===0?c(m):c(f,!1)})}_(s,n),ae()}var fa=k('<p class="empty-state">暂无储蓄目标记录</p>'),pa=k('<span class="badge badge-primary">已完成</span>'),ha=k('<span class="badge badge-secondary">进行中</span>'),ba=k('<span class="badge badge-danger">已删除</span>'),_a=k('<tr><td class="svelte-167059g"> </td><td class="svelte-167059g"> </td><td class="svelte-167059g"><!> <!></td><td class="svelte-167059g"> </td></tr>'),ya=k('<div class="goals-table svelte-167059g"><table class="svelte-167059g"><thead><tr><th class="svelte-167059g">目标名称</th><th class="svelte-167059g">金额</th><th class="svelte-167059g">状态</th><th class="svelte-167059g">完成时间</th></tr></thead><tbody></tbody></table></div>'),wa=k('<div class="card"><h3>储蓄目标记录</h3> <!></div>');function xa(s,t){ee(t,!1);let a=j(t,"goals",24,()=>[]);const l=c=>c?new Date(c).toLocaleString():"未完成";te();var n=wa(),v=i(o(n),2);{var m=c=>{var u=fa();_(c,u)},f=c=>{var u=ya(),x=o(u),y=i(o(x));ke(y,5,a,Se,(w,b)=>{var D=_a();let $;var S=o(D),p=o(S),L=i(S),h=o(L),M=i(L),P=o(M);{var C=T=>{var J=pa();_(T,J)},z=T=>{var J=ha();_(T,J)};E(P,T=>{e(b).completed?T(C):T(z,!1)})}var I=i(P,2);{var N=T=>{var J=ba();_(T,J)};E(I,T=>{e(b).deleted&&T(N)})}var F=i(M),K=o(F);R((T,J,V)=>{$=_e(D,1,"svelte-167059g",null,$,T),B(p,e(b).name),B(h,`¥${J??""}`),B(K,V)},[()=>({"goal-deleted":e(b).deleted,"goal-completed":e(b).completed}),()=>e(b).amount.toFixed(2),()=>l(e(b).completedAt)],X),_(w,D)}),_(c,u)};E(v,c=>{a().length===0?c(m):c(f,!1)})}_(s,n),ae()}var ka=k('<div class="admin-panel svelte-1wcnuld"><div class="admin-header svelte-1wcnuld"><h2 class="svelte-1wcnuld">储钱罐管理</h2> <button class="btn btn-danger logout-btn svelte-1wcnuld">退出登录</button></div> <!> <!> <!></div>');function Sa(s,t){ee(t,!1);const[a,l]=Re(),n=()=>je(fe,"$piggyBankStore",a);let v=j(t,"onLogout",8,()=>{});const m=(b,D)=>{Et(b,D)};te();var f=ka(),c=o(f),u=i(o(c),2),x=i(c,2);ca(x,{get balance(){return n().balance},onUpdateBalance:m});var y=i(x,2);ma(y,{get transactions(){return n().transactions}});var w=i(y,2);xa(w,{get goals(){return n().goals}}),q("click",u,function(...b){var D;(D=v())==null||D.apply(this,b)}),_(s,f),ae(),l()}var Aa=k('<div class="error svelte-190unu1"> </div>'),Da=k('<div class="password-protect svelte-190unu1"><div class="form-container svelte-190unu1"><h2 class="svelte-190unu1">家长身份验证</h2> <p class="svelte-190unu1">请输入家长密码访问管理功能<br><small>(这不是重新登录，而是额外的安全验证)</small></p> <form><div class="form-group svelte-190unu1"><label for="username" class="svelte-190unu1">用户名:</label> <input type="text" id="username" placeholder="请输入用户名" autocomplete="username" class="svelte-190unu1"></div> <div class="form-group svelte-190unu1"><label for="password" class="svelte-190unu1">家长密码:</label> <input type="password" id="password" placeholder="请输入家长密码" autocomplete="current-password" class="svelte-190unu1"> <small class="help-text svelte-190unu1">默认家长密码为: keep</small></div> <!> <button type="submit" class="svelte-190unu1">验证</button></form></div></div>');function $a(s,t){ee(t,!1);const a="keep";let l=j(t,"authenticated",12,!1),n=A(me()||""),v=A(""),m=A("");const f=()=>{if(!e(n).trim()){r(m,"请输入用户名");return}e(v)===a?(r(m,""),l(!0),rt(!0)):(r(m,"密码错误，请重试"),r(v,""))};Oe(()=>{r(n,me()||"")}),te();var c=Da(),u=o(c),x=i(o(u),4),y=o(x),w=i(o(y),2),b=i(y,2),D=i(o(b),2),$=i(b,2);{var S=p=>{var L=Aa(),h=o(L);R(()=>B(h,e(m))),_(p,L)};E($,p=>{e(m)&&p(S)})}R(p=>w.disabled=p,[()=>!!me()],X),ie(w,()=>e(n),p=>r(n,p)),ie(D,()=>e(v),p=>r(v,p)),q("submit",x,Je(f)),_(s,c),ae()}var Ba=k('<div class="error-message"> </div>'),Ta=k('<div class="simple-login-container svelte-hk1mv"><h2 class="svelte-hk1mv">宝宝登录</h2> <p class="svelte-hk1mv">输入用户名开始使用储钱罐</p> <form><div class="form-group"><label for="username">用户名</label> <input type="text" id="username" placeholder="请输入用户名" autocomplete="username"></div> <!> <button type="submit" class="btn btn-primary"> </button> <div class="login-option svelte-hk1mv"><button type="button" class="link-button back-button svelte-hk1mv">返回选择</button></div></form></div>');function Fa(s,t){ee(t,!1);const a=Fe();let l=j(t,"savedUsername",8,""),n=A(l()||""),v=A(!1),m=A("");const f=async()=>{if(r(m,""),!e(n).trim()){r(m,"请输入用户名");return}try{r(v,!0),(await $t(e(n))).exists?(wt(e(n)),a("success",{username:e(n)})):r(m,"用户不存在，请检查用户名或注册")}catch(h){console.error("检查用户名失败:",h),r(m,h.message||"登录失败，请稍后重试")}finally{r(v,!1)}},c=()=>{a("back")};te();var u=Ta(),x=i(o(u),4),y=o(x),w=i(o(y),2),b=i(y,2);{var D=h=>{var M=Ba(),P=o(M);R(()=>B(P,e(m))),_(h,M)};E(b,h=>{e(m)&&h(D)})}var $=i(b,2),S=o($),p=i($,2),L=o(p);R(()=>{w.disabled=e(v),$.disabled=e(v),B(S,e(v)?"正在验证...":"开始使用")}),ie(w,()=>e(n),h=>r(n,h)),q("click",L,c),q("submit",x,Je(f)),_(s,u),ae()}var La=k('<div class="auth-container simple svelte-1m63we6"><div class="auth-card svelte-1m63we6"><h2 class="svelte-1m63we6">欢迎使用小猪储钱罐</h2> <p class="svelte-1m63we6">请输入用户名开始使用</p> <!></div></div>'),Ma=k('<div class="form-group"><label for="displayName">显示名称</label> <input type="text" id="displayName" placeholder="请输入显示名称"> <small>这是其他人看到的名称</small></div>'),Pa=k('<div class="error-message"> </div>'),Ea=k('<div class="auth-container svelte-1m63we6"><div class="auth-card svelte-1m63we6"><h2 class="svelte-1m63we6"> </h2> <p class="svelte-1m63we6"> </p> <form><div class="form-group"><label for="username">用户名</label> <input type="text" id="username" placeholder="请输入用户名" autocomplete="username"></div> <div class="form-group"><label for="password">密码</label> <input type="password" id="password" placeholder="请输入密码"></div> <!> <!> <button type="submit" class="btn btn-primary"> </button> <div class="toggle-mode svelte-1m63we6"><span> </span> <button type="button" class="link-button svelte-1m63we6"> </button></div> <div class="toggle-mode svelte-1m63we6"><button type="button" class="link-button back-button svelte-1m63we6">返回选择</button></div></form></div></div>');function Ca(s,t){ee(t,!1);const a=Fe();let l=j(t,"mode",8,"simple"),n=A(!0),v=A(me()||""),m=A(""),f=A(""),c=A(!1),u=A("");const x=()=>{r(n,!e(n)),r(u,"")},y=()=>{a("mode-change",{mode:"login"})},w=()=>{a("mode-change",{mode:"selector"})},b=h=>{a("success",{username:h.detail.username,simpleLogin:!0})},D=async()=>{if(r(u,""),console.log("准备提交登录表单",{username:e(v),password:e(m),isLoginMode:e(n)}),!e(v).trim()){r(u,"请输入用户名");return}if(!e(m).trim()){r(u,"请输入密码");return}if(!e(n)&&!e(f).trim()){r(u,"请输入显示名称");return}try{if(r(c,!0),e(n)){console.log("开始登录流程...");const M=await St(e(v),e(m));console.log("登录响应:",M)}else console.log("开始注册流程..."),await At(e(v),e(m),e(f));const h=ot();console.log("获取当前用户信息:",h),a("success",{user:h,simpleLogin:!1})}catch(h){console.error("登录/注册失败:",h),r(u,h.message||(e(n)?"登录失败，请检查用户名和密码":"注册失败"))}finally{r(c,!1)}};te();var $=he(),S=be($);{var p=h=>{var M=La(),P=o(M),C=i(o(P),4);Fa(C,{get savedUsername(){return e(v)},$$events:{success:b,"switch-mode":y,back:w}}),_(h,M)},L=h=>{var M=Ea(),P=o(M),C=o(P),z=o(C),I=i(C,2),N=o(I),F=i(I,2),K=o(F),T=i(o(K),2),J=i(K,2),V=i(o(J),2),oe=i(J,2);{var d=O=>{var Y=Ma(),ve=i(o(Y),2);R(()=>ve.disabled=e(c)),ie(ve,()=>e(f),de=>r(f,de)),_(O,Y)};E(oe,O=>{e(n)||O(d)})}var g=i(oe,2);{var U=O=>{var Y=Pa(),ve=o(Y);R(()=>B(ve,e(u))),_(O,Y)};E(g,O=>{e(u)&&O(U)})}var G=i(g,2),H=o(G),W=i(G,2),se=o(W),ce=o(se),Z=i(se,2),Q=o(Z),ne=i(W,2),le=o(ne);R(()=>{B(z,e(n)?"家长登录":"注册账号"),B(N,e(n)?"输入用户名和密码":"创建新账号"),T.disabled=e(c),V.disabled=e(c),at(V,"autocomplete",e(n)?"current-password":"new-password"),G.disabled=e(c),B(H,e(c)?"处理中...":e(n)?"登录":"注册"),B(ce,e(n)?"还没有账号？":"已有账号？"),Z.disabled=e(c),B(Q,e(n)?"立即注册":"立即登录"),le.disabled=e(c)}),ie(T,()=>e(v),O=>r(v,O)),ie(V,()=>e(m),O=>r(m,O)),q("click",Z,x),q("click",le,w),q("submit",F,Je(D)),_(h,M)};E(S,h=>{l()==="simple"?h(p):h(L,!1)})}_(s,$),ae()}var Ga=k('<div class="selector-container svelte-ct8nfn"><div class="selector-card svelte-ct8nfn"><h2 class="svelte-ct8nfn">欢迎使用小猪储钱罐</h2> <p class="svelte-ct8nfn">请选择你的身份</p> <div class="button-container svelte-ct8nfn"><button class="role-button kid-button svelte-ct8nfn"><div class="icon svelte-ct8nfn">👶</div> <span>我是宝宝</span></button> <button class="role-button parent-button svelte-ct8nfn"><div class="icon svelte-ct8nfn">👨‍👩‍👧</div> <span>我是家长</span></button></div></div></div>');function Ia(s,t){ee(t,!1);const a=Fe(),l=u=>{a("select",{role:u})};te();var n=Ga(),v=o(n),m=i(o(v),4),f=o(m),c=i(f,2);q("click",f,()=>l("kid")),q("click",c,()=>l("parent")),_(s,n),ae()}var Ua=k("<button>家长管理</button>"),qa=k('<div class="user-menu svelte-hohvrf"><span class="username svelte-hohvrf"> </span> <button class="logout-btn svelte-hohvrf">退出</button></div>'),Na=k('<button class="svelte-hohvrf">登录/注册</button>'),Oa=k('<div class="loading svelte-hohvrf"><div class="spinner svelte-hohvrf"></div> <p>加载中...</p></div>'),ja=k('<div class="auth-prompt svelte-hohvrf"><h2>欢迎使用小猪储钱罐</h2> <p>请先登录后使用储钱罐功能</p> <button class="btn">去登录</button></div>'),Ra=k('<main class="svelte-hohvrf"><header class="svelte-hohvrf"><div class="logo svelte-hohvrf">小猪储钱罐</div> <nav class="svelte-hohvrf"><button>储钱罐</button> <!> <!></nav></header> <div class="content svelte-hohvrf"><!></div> <footer class="svelte-hohvrf"><p> </p></footer></main>');function Ja(s,t){ee(t,!1);let a=A("home"),l=A(!1),n=A(!1),v=A("selector"),m=A(!0),f=A(null),c=A("");const u=d=>{if(d==="admin"&&!e(n)&&!pe()&&!qe()&&!pe()){alert("请先输入用户名"),u("login");return}r(a,d)},x=(d=!0)=>{d?(Dt(),lt(!0),r(l,!1),r(n,!1),r(f,null),r(c,""),r(v,"selector")):(rt(!1),r(n,!1)),u("home")},y=d=>{d.detail.simpleLogin?(r(c,d.detail.username),r(l,!0)):(r(f,d.detail.user),r(c,e(f).username),r(l,!0),r(n,!0)),Qe(),u("home")},w=d=>{r(v,d.detail.mode)},b=d=>{const g=d.detail.role;g==="kid"?r(v,"simple"):g==="parent"&&r(v,"login")},D=()=>{r(v,"selector"),u("login")};Oe(async()=>{r(m,!0);try{pe()?(r(f,ot()),r(c,e(f).username),r(l,!0),r(n,!0),r(v,"login")):qe()?(r(c,me()),r(l,!0),r(v,"simple")):r(v,"selector"),await Qe();const g=new URLSearchParams(window.location.search).get("page");g==="admin"?r(a,"admin"):g==="login"&&r(a,"login"),window.addEventListener("popstate",()=>{const G=new URLSearchParams(window.location.search).get("page");G==="admin"?r(a,"admin"):G==="login"?r(a,"login"):r(a,"home")})}catch(d){console.error("初始化失败:",d)}finally{r(m,!1)}}),we(()=>e(a),()=>{if(typeof window<"u"){const d=new URL(window.location.href);e(a)==="home"?d.searchParams.delete("page"):d.searchParams.set("page",e(a)),history.pushState({},"",d)}}),Te(),te();var $=Ra(),S=o($),p=i(o(S),2),L=o(p);let h;var M=i(L,2);{var P=d=>{var g=Ua();let U;R(G=>U=_e(g,1,"svelte-hohvrf",null,U,G),[()=>({active:e(a)==="admin"})],X),q("click",g,()=>u("admin")),_(d,g)};E(M,d=>{e(n)&&d(P)})}var C=i(M,2);{var z=d=>{var g=qa(),U=o(g),G=o(U),H=i(U,2);R(()=>{var W;return B(G,((W=e(f))==null?void 0:W.displayName)||e(c))}),q("click",H,()=>x(!0)),_(d,g)},I=d=>{var g=Na();q("click",g,D),_(d,g)};E(C,d=>{e(l)?d(z):d(I,!1)})}var N=i(S,2),F=o(N);{var K=d=>{var g=Oa();_(d,g)},T=(d,g)=>{{var U=H=>{var W=ja(),se=i(o(W),4);q("click",se,D),_(H,W)},G=(H,W)=>{{var se=Z=>{var Q=he(),ne=be(Q);{var le=Y=>{Ia(Y,{$$events:{select:b}})},O=Y=>{Ca(Y,{get mode(){return e(v)},$$events:{success:y,"mode-change":w}})};E(ne,Y=>{e(v)==="selector"?Y(le):Y(O,!1)})}_(Z,Q)},ce=(Z,Q)=>{{var ne=O=>{na(O,{})},le=(O,Y)=>{{var ve=de=>{var $e=he(),Pe=be($e);{var Be=ue=>{Sa(ue,{onLogout:()=>x(!1)})},Ee=ue=>{$a(ue,{get authenticated(){return e(n)},set authenticated(Ce){r(n,Ce)},$$legacy:!0})};E(Pe,ue=>{e(n)||pe()?ue(Be):ue(Ee,!1)})}_(de,$e)};E(O,de=>{e(a)==="admin"&&de(ve)},Y)}};E(Z,O=>{e(a)==="home"?O(ne):O(le,!1)},Q)}};E(H,Z=>{e(a)==="login"?Z(se):Z(ce,!1)},W)}};E(d,H=>{!e(l)&&e(a)!=="login"?H(U):H(G,!1)},g)}};E(F,d=>{e(m)?d(K):d(T,!1)})}var J=i(N,2),V=o(J),oe=o(V);R((d,g)=>{h=_e(L,1,"svelte-hohvrf",null,h,d),B(oe,`© ${g??""} 小猪储钱罐 - 帮助孩子学习理财`)},[()=>({active:e(a)==="home"}),()=>new Date().getFullYear()],X),q("click",L,()=>u("home")),_(s,$),ae()}_t(Ja,{target:document.getElementById("app")});
